<div class="container">
  <div class="row" style="margin-bottom: 10px">
    <div class="col-12">
      <button style="width: 100px" mat-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Voltar
      </button>
    </div>
  </div>
  <form [formGroup]="form">
    <mat-card>
      <mat-card-title style="margin: 15px">{{
        isEditMode ? "Editar Template" : "Criar Template"
      }}</mat-card-title>
      <mat-card-content>
        <mat-form-field class="w-100">
          <mat-label>Nome do Template</mat-label>
          <input matInput formControlName="name" />
        </mat-form-field>

        <mat-form-field class="w-100">
          <mat-label>Tipo de Notificação</mat-label>
          <mat-select formControlName="emailType">
            <mat-option value="cadastro">Cadastro do Usuário</mat-option>
            <mat-option value="conviteAvaliador"
              >Convite - Avaliador</mat-option
            >
            <mat-option value="conviteRespondente"
              >Convite - Avaliado</mat-option
            >
            <mat-option value="lembreteAvaliador"
              >Lembrete - Avaliador</mat-option
            >
            <mat-option value="lembreteRespondente"
              >Lembrete - Avaliado</mat-option
            >
          </mat-select>
        </mat-form-field>

        <mat-form-field class="w-100">
          <mat-label>Assunto</mat-label>
          <input matInput formControlName="subject" />
        </mat-form-field>

        <!-- Campo de Cliente (apenas admin_master ou preenchido automaticamente) -->
        <mat-form-field
          class="w-100"
          *ngIf="userRole === 'admin_master' && !clientIdFromRoute"
        >
          <mat-label>Cliente</mat-label>
          <mat-select formControlName="clientId">
            <mat-option value="">TEMPLATE PADRÃO</mat-option>
            <mat-option *ngFor="let client of clients" [value]="client.id">
              {{ client.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Para admin_client ou clientId da rota, exibir como texto ou hidden -->
        <div
          *ngIf="!clientIdFromRoute || userRole === 'admin_client'"
          class="w-100"
        >
          <p>
            <strong>Cliente:</strong>
            {{ clientNameFromRoute || "Não identificado" }}
          </p>
          <input
            type="hidden"
            formControlName="clientId"
            [value]="clientIdFromRoute || userClientId"
          />
        </div>

        <!-- Exibir apenas clientName se vier da rota -->
        <div *ngIf="clientIdFromRoute && !projectIdFromRoute" class="w-100">
          <p>
            <strong>Cliente:</strong>
            {{ clientNameFromRoute || "Não identificado" }}
          </p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Editor Unlayer -->
    <div class="col-12">
      <email-editor
        [options]="{ locale: 'pt' }"
        (ready)="onEditorReady()"
      ></email-editor>
    </div>

    <div class="text-end mt-3">
      <button mat-flat-button color="primary" (click)="saveTemplate()">
        {{ isEditMode ? "Salvar Alterações" : "Criar Template" }}
      </button>
    </div>
  </form>
</div>
