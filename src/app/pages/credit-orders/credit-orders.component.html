<div class="container my-4">
  <mat-card>
    <!-- Título -->
    <div class="row mb-4">
      <div class="col-12">
        <h4 class="mb-3" style="margin: 15px">Gestão de Pedidos de Crédito</h4>
      </div>
    </div>

    <!-- Filtros -->
    <div
      class="row mb-4 align-items-center"
      style="width: 100%; margin-left: 2px"
    >
      <!-- Filtro Data Início -->
      <div class="col-md-4 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Data Início</mat-label>
          <input
            matInput
            [matDatepicker]="startDatePicker"
            [(ngModel)]="startDate"
            (dateChange)="applyFilter()"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startDatePicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- Filtro Data Fim -->
      <div class="col-md-4 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Data Fim</mat-label>
          <input
            matInput
            [matDatepicker]="endDatePicker"
            [(ngModel)]="endDate"
            (dateChange)="applyFilter()"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endDatePicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- Filtro Status -->
      <div class="col-md-4 mb-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Status</mat-label>
          <mat-select
            [(ngModel)]="selectedStatus"
            (selectionChange)="applyFilter()"
          >
            <mat-option value="">Todos</mat-option>
            <mat-option value="Pendente">Pendente</mat-option>
            <mat-option value="Aprovado">Aprovado</mat-option>
            <mat-option value="Rejeitado">Rejeitado</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Botão Limpar Filtros -->
    <div class="row mb-4">
      <div
        class="col-md-12 text-end"
        style="padding-right: 37px; text-align: end; margin: 0px 0px 10px"
      >
        <button mat-flat-button color="accent" (click)="resetFilters()">
          Limpar Filtros
        </button>
      </div>
    </div>

    <!-- Campo de busca -->
    <div class="row mb-3" style="width: 100%; margin-left: 0px">
      <div class="col-12">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Buscar</mat-label>
          <input
            matInput
            (keyup)="applyFilter()"
            placeholder="Digite para buscar"
          />
        </mat-form-field>
      </div>
    </div>

    <!-- Tabela -->
    <mat-card-content>
      <div class="table-responsive">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z8 w-100"
          matSort
        >
          <!-- ID -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
            <td mat-cell *matCellDef="let order">{{ order.id }}</td>
          </ng-container>

          <!-- Cliente -->
          <ng-container matColumnDef="clientName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</th>
            <td mat-cell *matCellDef="let order">
              {{ order.clientName || "Cliente não identificado" }}
            </td>
          </ng-container>

          <!-- Total -->
          <ng-container matColumnDef="totalAmount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Total</th>
            <td mat-cell *matCellDef="let order">
              {{ order.totalAmount | currency : "BRL" }}
            </td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td
              mat-cell
              *matCellDef="let order"
              [ngClass]="{
                'status-pending': order.status === 'Pendente',
                'status-approved': order.status === 'Aprovado',
                'status-rejected': order.status === 'Rejeitado'
              }"
            >
              {{ order.status }}
            </td>
          </ng-container>

          <!-- Criado em -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Criado em</th>
            <td mat-cell *matCellDef="let order">
              {{ order.createdAt | date : "dd/MM/yyyy, HH:mm" }}
            </td>
          </ng-container>

          <!-- Ações -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Ações</th>
            <td mat-cell *matCellDef="let order">
              <button
                mat-icon-button
                color="primary"
                matTooltip="Aprovar Pedido"
                *ngIf="order.status === 'Pendente'"
                (click)="approveOrder(order.id)"
              >
                <mat-icon>check</mat-icon>
              </button>
              <button
                mat-icon-button
                color="warn"
                matTooltip="Rejeitar Pedido"
                *ngIf="order.status === 'Pendente'"
                (click)="rejectOrder(order.id)"
              >
                <mat-icon>close</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    </mat-card-content>

    <!-- Paginação e botão novo pedido -->
    <div class="row mt-3">
      <div class="col-md-6 d-flex align-items-center">
        <mat-paginator
          [pageSize]="5"
          [pageSizeOptions]="[5, 10, 20]"
        ></mat-paginator>
      </div>
      <div
        class="col-md-6 text-end"
        style="text-align: end; padding-right: 33px"
      >
        <button mat-flat-button color="primary" (click)="openNewOrderForm()">
          Novo Pedido
        </button>
      </div>
    </div>
  </mat-card>
</div>
